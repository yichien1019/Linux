# üìù VLAN 
## üìñ Âü∫Á§éË®≠ÂÆö
![](pic/vlan1.png)
* R1
```
Router(config) # hostname R1
R1(config) # int e0/0
R1(config-if) # ip addr 192.168.1.1 255.255.255.0  
R1(config-if) # no shutdown
R1 # show ip int brief
    Interface              IP-Address      OK? Method Status            
        Protocol
    Ethernet0/0            192.168.1.1     YES manual administratively d
    own down    
    Ethernet0/1            unassigned      YES unset  administratively d
    own down    
    Ethernet0/2            unassigned      YES unset  administratively d
    own down    
    Ethernet0/
```
* R2
```
Router(config) # hostname R2
R2(config) # int e0/0
R2(config-if) # ip addr 192.168.1.2 255.255.255.0  
R2(config-if) # no shutdown
R2 # show ip int brief
    Interface              IP-Address      OK? Method Status            
        Protocol
    Ethernet0/0            192.168.1.1     YES manual administratively d
    own down    
    Ethernet0/1            unassigned      YES unset  administratively d
    own down    
    Ethernet0/2            unassigned      YES unset  administratively d
    own down    
    Ethernet0/
```
* R3
```
Router(config) # hostname R3
R3(config) # int e0/0
R3(config-if) # ip addr 192.168.1.3 255.255.255.0  
R3(config-if) # no shutdown
R3 # show ip int brief
    Interface              IP-Address      OK? Method Status            
        Protocol
    Ethernet0/0            192.168.1.1     YES manual administratively d
    own down    
    Ethernet0/1            unassigned      YES unset  administratively d
    own down    
    Ethernet0/2            unassigned      YES unset  administratively d
    own down    
    Ethernet0/
```
* R4
```
Router(config) # hostname R4
R4(config) # int e0/0
R4(config-if) # ip addr 192.168.1.4 255.255.255.0  
R4(config-if) # no shutdown
R4 # show ip int brief
    Interface              IP-Address      OK? Method Status            
        Protocol
    Ethernet0/0            192.168.1.1     YES manual administratively d
    own down    
    Ethernet0/1            unassigned      YES unset  administratively d
    own down    
    Ethernet0/2            unassigned      YES unset  administratively d
    own down    
    Ethernet0/
```
* ÊàêÊûú - ÂèØ‰ª•‰∫í ping
```
R1 # ping 192.168.1.2
    Type escape sequence to abort.
    Sending 5, 100-byte ICMP Echos to 192.168.1.2, timeout is 2 second
    s:
    !!!!!
    Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/1 
    ms
R2 # ping 192.168.1.3
    Type escape sequence to abort.
    Sending 5, 100-byte ICMP Echos to 192.168.1.3, timeout is 2 second
    s:
    !!!!!
    Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/1 
    ms
```
## üîñ SWITCH ÂàáÂâ≤ VLAN
![](pic/vlan2.png)
* vlan ÂâµÂª∫ÂëΩÂêç
```
Switch(config) # vlan 10
Switch(config-vlan) # name yellow
Switch(config-vlan) # vlan 20
Switch(config-vlan) # name green
Switch#show vlan

    VLAN Name                             Status    Ports
    ---- -------------------------------- --------- -------------------------------
    1    default                          active    Et0/0, Et0/1, Et0/2, Et0/3
    10   yellow                           active    
    20   green                            active    
    1002 fddi-default                     act/unsup 
    1003 token-ring-default               act/unsup 
    1004 fddinet-default                  act/unsup 
    1005 trnet-default                    act/unsup 

    VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
    ---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
    1    enet  100001     1500  -      -      -        -    -        0      0   
    10   enet  100010     1500  -      -      -        -    -        0      0   
    20   enet  100020     1500  -      -      -        -    -        0      0   
    1002 fddi  101002     1500  -      -      -        -    -        0      0   
    1003 tr    101003     1500  -      -      -        -    -        0      0   
    1004 fdnet 101004     1500  -      -      -        ieee -        0      0   
    1005 trnet 101005     1500  -      -      -        ibm  -        0      0
```
* Â∞á Router ÊîæÂÖ• switchport
```
Switch(config) # int e0/0
Switch(config-if) # switchport access vlan 10
Switch(config-if) # int e0/2
Switch(config-if) # switchport access vlan 10
Switch(config-if) # int e0/1
Switch(config-if) # switchport access vlan 20
Switch(config-if) # int e0/3
Switch(config-if) # switchport access vlan 20
```
* ÊàêÊûú - ‰∏çÂêå switchport ‰∏çÂèØ‰∫í ping
```
R1 # ping 192.168.1.2
    Type escape sequence to abort.
    Sending 5, 100-byte ICMP Echos to 192.168.1.2, timeout is 2 seconds:
    !!!!!
    Success rate is 100 percent (5/5), round-trip min/avg/max = 1/1/2 ms
R1 # ping 192.168.1.3
    Type escape sequence to abort.
    Sending 5, 100-byte ICMP Echos to 192.168.1.3, timeout is 2 seconds:
..
```

```
Switch#show vlan

    VLAN Name                             Status    Ports
    ---- -------------------------------- --------- -------------------------------
    1    default                          active    
    10   yellow                           active    Et0/0, Et0/2
    20   green                            active    Et0/1, Et0/3
    1002 fddi-default                     act/unsup 
    1003 token-ring-default               act/unsup 
    1004 fddinet-default                  act/unsup 
    1005 trnet-default                    act/unsup 

    VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
    ---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
    1    enet  100001     1500  -      -      -        -    -        0      0   
    10   enet  100010     1500  -      -      -        -    -        0      0   
    20   enet  100020     1500  -      -      -        -    -        0      0   
    1002 fddi  101002     1500  -      -      -        -    -        0      0   
    1003 tr    101003     1500  -      -      -        -    -        0      0   
    1004 fdnet 101004     1500  -      -      -        ieee -        0      0   
    1005 trnet 101005     1500  -      -      -        ibm  -        0      0   
```
## üîñ TRUNK LINK
![](pic/vlan3.png)
* SW1 vlan Ë®≠ÂÆö
```
SW1 # show vlan

    VLAN Name                             Status    Ports
    ---- -------------------------------- --------- -------------------------------
    1    default                          active    Et0/3
    10   yellow                           active    Et0/0
    20   green                            active    Et0/1
    1002 fddi-default                     act/unsup 
    1003 token-ring-default               act/unsup 
    1004 fddinet-default                  act/unsup 
    1005 trnet-default                    act/unsup 

    VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
    ---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
    1    enet  100001     1500  -      -      -        -    -        0      0   
    10   enet  100010     1500  -      -      -        -    -        0      0   
    20   enet  100020     1500  -      -      -        -    -        0      0   
    1002 fddi  101002     1500  -      -      -        -    -        0      0   
    1003 tr    101003     1500  -      -      -        -    -        0      0   
    1004 fdnet 101004     1500  -      -      -        ieee -        0      0   
    1005 trnet 101005     1500  -      -      -        ibm  -        0      0   
```
* SW2 vlan Ë®≠ÂÆö
```
SW2 # show vlan

    VLAN Name                             Status    Ports
    ---- -------------------------------- --------- -------------------------------
    1    default                          active    Et0/3
    10   yellow                           active    Et0/0
    20   green                            active    Et0/1
    1002 fddi-default                     act/unsup 
    1003 token-ring-default               act/unsup 
    1004 fddinet-default                  act/unsup 
    1005 trnet-default                    act/unsup 

    VLAN Type  SAID       MTU   Parent RingNo BridgeNo Stp  BrdgMode Trans1 Trans2
    ---- ----- ---------- ----- ------ ------ -------- ---- -------- ------ ------
    1    enet  100001     1500  -      -      -        -    -        0      0   
    10   enet  100010     1500  -      -      -        -    -        0      0   
    20   enet  100020     1500  -      -      -        -    -        0      0   
    1002 fddi  101002     1500  -      -      -        -    -        0      0   
    1003 tr    101003     1500  -      -      -        -    -        0      0   
    1004 fdnet 101004     1500  -      -      -        ieee -        0      0   
    1005 trnet 101005     1500  -      -      -        ibm  -        0      0   
```
* Â∞á Switch ÁöÑ Interface Ë®≠ÂÆöÊàê 802.1q Trunk
```
SW1(config) # int e0/2
SW1(config-if) # switchport trunk encapsulation dot1q
SW1(config-if) # switchport mode trunk
SW1 # show int trunk

    Port        Mode             Encapsulation  Status        Native vlan
    Et0/2       on               802.1q         trunking      1

    Port        Vlans allowed on trunk
    Et0/2       1-4094

    Port        Vlans allowed and active in management domain
    Et0/2       1,10,20

    Port        Vlans in spanning tree forwarding state and not pruned
    Et0/2       1,10,20
```
```
SW2(config) # int e0/2
SW2(config-if) # switchport trunk encapsulation dot1q
SW2(config-if) # switchport mode trunk
SW2 # show int trunk

    Port        Mode             Encapsulation  Status        Native vlan
    Et0/2       on               802.1q         trunking      1

    Port        Vlans allowed on trunk
    Et0/2       1-4094

    Port        Vlans allowed and active in management domain
    Et0/2       1,10,20

    Port        Vlans in spanning tree forwarding state and not pruned
    Et0/2       1,10,20
```
* R1 ÂèØ‰ª• ping R3 ÔºåÂçªÁÑ°Ê≥ïËàáÂÖ∂‰ªñÊ∫ùÈÄö
```
R1 # ping 192.168.1.3
    Type escape sequence to abort.
    Sending 5, 100-byte ICMP Echos to 192.168.1.3, timeout is 2 seconds:
    .!!!!
    Success rate is 80 percent (4/5), round-trip min/avg/max = 1/1/2 ms
R1 # ping 192.168.1.2
    Type escape sequence to abort.
    Sending 5, 100-byte ICMP Echos to 192.168.1.2, timeout is 2 seconds:
    .....
    Success rate is 0 percent (0/5)
R1 # ping 192.168.1.4
    Type escape sequence to abort.
    Sending 5, 100-byte ICMP Echos to 192.168.1.4, timeout is 2 seconds:
    .....
    Success rate is 0 percent (0/5)
```
## üîñ ALLOWED VLAN
```
SW1(config-if) # switchport trunk allowed vlan 10,20,30
SW1 # show int trunk

    Port        Mode             Encapsulation  Status        Native vlan
    Et0/2       on               802.1q         trunking      1

    Port        Vlans allowed on trunk
    Et0/2       10,20,30

    Port        Vlans allowed and active in management domain
    Et0/2       10,20

    Port        Vlans in spanning tree forwarding state and not pruned
    Et0/2       10,20
```
#### üëâ show int trunk Ë≥áÊñô
* `Vlans allowed on trunk` : ÈÄôÊ¢ù trunk ÂÖÅË®±ÈÄöÈÅéÁöÑ vlan
* `Vlans allowed and active in management domain` : Âú®ÈÄôÂÄã Switch ‰∏äÂè™Â≠òÂú® VLAN 10„ÄÅ20ÔºåÊâÄ‰ª•ÂØ¶Èöõ‰∏ä VLAN 30 ÈÅé‰∏ç‰∫Ü
* `Vlans in spanning tree forwarding state and not pruned` : ÁúüÊ≠£ÂèØ‰ª•ÈÄöÈÅéÁöÑ VLAN ÔºåÂç≥ VLAN 10„ÄÅ20
* `witchport trunk allowed vlan ?` : 
    ```
    SW1(config-if) # switchport trunk allowed vlan ?       
        WORD    VLAN IDs of the allowed VLANs when this port is in trunking mode
        add     add VLANs to the current list
        all     all VLANs
        except  all VLANs except the following
        none    no VLANs
        remove  remove VLANs from the current list
    ```
    * `add` : ‰øùÁïôÂéüË®≠ÂÆöÂ§ñÂú®È°çÂ§ñÂ¢ûÂä† VLAN
        * ÂéüË®≠ÂÆö : 1-100
        * Êåá‰ª§ : `switchport trunk allowed vlan add 100-200`
        * Êñ∞Ë®≠ÂÆö : 1-200
    * `all` : ÂÖÅË®±ÂÖ®ÈÉ® VLAN ÈÄöÈÅé
        * ÂéüË®≠ÂÆö : 1-100
        * Êåá‰ª§ : `switchport trunk allowed vlan all`
        * Êñ∞Ë®≠ÂÆö : 1-4094
    * `except` : ÂÖÅË®±Èô§‰∫ÜÁâπÂÆö VLAN Â§ñÁöÑÂÖ®ÈÉ® VLAN (1-4094) ÈÄöÈÅé
        * ÂéüË®≠ÂÆö : 1-100
        * Êåá‰ª§ : `switchport trunk allowed vlan except 100-200`
        * Êñ∞Ë®≠ÂÆö : 1-99„ÄÅ201-4094
    * `none` : ‰∏çÂÖÅË®±‰ªª‰Ωï VLAN ÈÄöÈÅé
        * ÂéüË®≠ÂÆö : 1-100
        * Êåá‰ª§ : `switchport trunk allowed vlan none`
        * Êñ∞Ë®≠ÂÆö : none
    * `remove` : ‰øùÁïôÂéü Allowed VLAN Ë®≠ÂÆöÔºåÂÜçÁßªÈô§ÁâπÂÆö VLAN
        * ÂéüË®≠ÂÆö : 1-100
        * Êåá‰ª§ : `switchport trunk allowed vlan remove 20-30`
        * Êñ∞Ë®≠ÂÆö : 1-19„ÄÅ31-100
    > Ë£úÂÖÖ : VLAN <br>
    > IEEE 802.1Q ‰∏≠ÁöÑ VLAN ÂÉÖ‰ΩøÁî® 12 ‰Ωç <br>
    > Âõ†Ê≠§Âè™ËÉΩ‰ΩøÁî® 0-4095 ÁöÑ VLANÔºà2^12 = 4096 ‰∏çÂêåÁöÑ VLANÔºâ<br>
    > ÂÖ∂ÂØ¶Â∞ë‰∫Ü2ÂÄãÔºå0Âíå4095ÊòØ‰øùÁïôÁöÑÔºåÊâÄ‰ª•ËÉΩ‰ΩøÁî®ÁöÑÁÇ∫1-4094

### üëâ VLAN 1
* VLAN 1 ÊòØ‰∏ÄÂÄãÈ†êË®≠ÁöÑ VLANÔºåÂ§ßÈÉ®ÂàÜ Switch ÈÉΩÊúâ VLAN 1ÔºåËÄåÊâÄÊúâ port È†êË®≠Âú® VLAN 1 ‰∏≠
* VLAN 1 ÂíåÂÖ∂‰ªñ VLAN ‰∏ÄÊ®£ÂèØ‰ª•ÂÇ≥ÈÄÅ data ‰πãÂ§ñÔºåÈÇÑË≤†Ë≤¨ÂÇ≥ÈÄÅÊâÄË¨Ç Control Plane Traffic (Á∂≤Ë∑ØÂ±§)Ôºå‰æãÂ¶Ç: VTP, CDP, PAgP Á≠â
* VLAN 1 ÊáâÈÅøÂÖçÁµ¶‰∏ÄËà¨ HOST ‰ΩøÁî®ÔºåÂõ†ÁÇ∫ HOST Âà©Áî® Packet Capture ËªüÈ´îÂèØ‰ª•ËºïÊòì Capture Âà∞ Control Plane ÁöÑÈáçË¶Å‰ø°ÊÅØ

### üëâ NATIVE VLAN
* VLAN 1 È†êË®≠‰πüÊòØ Trunk Link ‰∏äÁöÑ‰∏ÄÂÄã Native VLAN
* Switch ÊääÈÄôÂÄã VLAN ÁöÑ Packet ÈÄÅ‰∏ä Trunk Link ÊôÇÔºåÊòØ‰∏çÊúÉÊîæÂÖ• VLAN Tag ÁöÑÔºåÂè™Ë¶Å Trunk Link ÂÖ©ÈÇäÁöÑ Switch ÈÉΩÂçîË≠∞Ê≤íÊúâ VLAN ID ÁöÑ Packet Â∞±ÊòØ VLAN 1ÔºåÈÇ£È∫Ω VLAN 1 Â∞±ÁÆóÊ≤íÊúâ VLAN ID ‰πüÂèØ‰ª•Ë¢´ÂçÄÂà•Âá∫‰æÜ

### üëâ VLAN INTERNAL USAGE
```
SW1 # show vlan int usa

    VLAN Usage
    ---- --------------------
```
* Êää port Ë®≠ÂÆöÊàê Layer 3 Port (1006 ÁÇ∫È†êË®≠)
```
SW1 # show vlan int usa

    VLAN Usage
    ---- --------------------
    1006 Ethernet0/1
```

## üìñ Ë£úÂÖÖË≥áÊñô
* [IEEE 802.1Q](https://en.wikipedia.org/wiki/IEEE_802.1Q#Frame_format)



üñäÔ∏è editor : yi-chien Liu